<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>linux - 标签 - Λ.W.log</title>
        <link>https://x.awo.design/tags/linux/</link>
        <description>linux - 标签 - Λ.W.log</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>imagicw@hotmail.com (imagicw)</managingEditor>
            <webMaster>imagicw@hotmail.com (imagicw)</webMaster><lastBuildDate>Tue, 06 Oct 2020 19:58:00 &#43;0800</lastBuildDate><atom:link href="https://x.awo.design/tags/linux/" rel="self" type="application/rss+xml" /><item>
    <title>树莓派的笔记</title>
    <link>https://x.awo.design/2020/10/raspberry-notes/</link>
    <pubDate>Tue, 06 Oct 2020 19:58:00 &#43;0800</pubDate>
    <author>作者</author>
    <guid>https://x.awo.design/2020/10/raspberry-notes/</guid>
    <description><![CDATA[<p>因为近期开发学习需要一台服务器，正好手头有闲置的树莓派3B+，所以就打算利用起来。运行环境 <code>ubuntu 20.04.1 64位</code></p>
<p>以下是一些备忘以及遇到的问题便记录了下来，日后可以参考。</p>
<h3 id="修改默认账号">修改默认账号</h3>
<p>需要进入root账号后进行修改，ubuntu 需要修改 <code>/etc/ssh/sshd_config</code> 中 <code>PermitRootLogin yes</code> ，全部完成后需将其改为默认值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 修改用户名 ubuntu 为 imagic</span>
usermod -l imagic ubuntu

<span class="c1"># 修改组名 ubuntu 为 imagic</span>
groupmod -n imagic ubuntu

<span class="c1"># 更改 ubuntu 的 home 目录为 imagic</span>
mv /home/ubuntu /home/imagic

<span class="c1"># 修改 /etc/passwd 中 imagic 的 home 的位置</span>
usermod -d /home/imagic imagic
</code></pre></td></tr></table>
</div>
</div><p>在 sudoers 将 ubuntu 的信息修改成 <code>imagic ALL=(ALL) NOPASSWD: ALL</code> 。</p>
<h3 id="mongodb-社区版">mongoDB 社区版</h3>
<h4 id="安装">安装</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 导入MongoDB 公共 GPG 密钥 mongodb5.0 不支持 armv7</span>
wget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc <span class="p">|</span> sudo apt-key add -

// 添加 mongodb 软件源
<span class="nb">echo</span> <span class="s2">&#34;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/4.4 multiverse&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list

sudo apt-get update
sudo apt-get install mongodb-org
</code></pre></td></tr></table>
</div>
</div><p>需要安装指定版本的 mongoDB 则使用如下命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sudo apt-get install -y mongodb-org<span class="o">=</span>4.4.1 mongodb-org-server<span class="o">=</span>4.4.1 mongodb-org-shell<span class="o">=</span>4.4.1 mongodb-org-mongos<span class="o">=</span>4.4.1 mongodb-org-tools<span class="o">=</span>4.4.1
</code></pre></td></tr></table>
</div>
</div><h4 id="运行">运行</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 启动、重启、停止、状态</span>
sudo service mongod start
sudo service mongod restart
sudo service mongod stop
sudo service mongod status
</code></pre></td></tr></table>
</div>
</div><h4 id="移除">移除</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># 移除</span>
sudo apt-get purge mongodb-org*
<span class="c1">## 删除数据库及日志</span>
sudo rm -r /var/log/mongodb
sudo rm -r /var/lib/mongodb
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">
curl -sL https://deb.nodesource.com/setup_14.x <span class="p">|</span> sudo bash -  


<span class="c1">#tcp</span>
iptables -t nat -N clash
iptables -t nat -A clash -d 0.0.0.0/8 -j RETURN
iptables -t nat -A clash -d 10.0.0.0/8 -j RETURN
iptables -t nat -A clash -d 127.0.0.0/8 -j RETURN
iptables -t nat -A clash -d 169.254.0.0/16 -j RETURN
iptables -t nat -A clash -d 172.16.0.0/12 -j RETURN
iptables -t nat -A clash -d 192.168.0.0/16 -j RETURN
iptables -t nat -A clash -d 224.0.0.0/4 -j RETURN
iptables -t nat -A clash -d 240.0.0.0/4 -j RETURN
iptables -t nat -A clash -d 10.0.0.3 -j RETURN
iptables -t nat -A clash -p tcp -j REDIRECT --to-port <span class="m">7892</span>
iptables -t nat -I PREROUTING -p tcp -d 8.8.8.8 -j REDIRECT --to-port <span class="m">7892</span>
iptables -t nat -I PREROUTING -p tcp -d 8.8.4.4 -j REDIRECT --to-port <span class="m">7892</span>
iptables -t nat -A PREROUTING -p tcp -j clash
iptables -t nat -A OUTPUT -p tcp -d 198.18.0.0/16 -j REDIRECT --to-port <span class="m">7892</span>

<span class="c1">#udp</span>
ip rule add fwmark <span class="m">1</span> table <span class="m">100</span>
ip route add <span class="nb">local</span> default dev lo table <span class="m">100</span>
iptables -t mangle -N clash
iptables -t mangle -A clash -d 0.0.0.0/8 -j RETURN
iptables -t mangle -A clash -d 10.0.0.0/8 -j RETURN
iptables -t mangle -A clash -d 127.0.0.0/8 -j RETURN
iptables -t mangle -A clash -d 169.254.0.0/16 -j RETURN
iptables -t mangle -A clash -d 172.16.0.0/12 -j RETURN
iptables -t mangle -A clash -d 192.168.0.0/16 -j RETURN
iptables -t mangle -A clash -d 224.0.0.0/4 -j RETURN
iptables -t mangle -A clash -d 240.0.0.0/4 -j RETURN
iptables -t mangle -A clash -d 10.0.0.3 -j RETURN
iptables -t mangle -A clash -p udp -j TPROXY --on-port <span class="m">7892</span> --tproxy-mark <span class="m">1</span>
iptables -t mangle -A OUTPUT -p udp -d 198.18.0.0/16 -j MARK --set-mark <span class="m">1</span>
iptables -t mangle -A PREROUTING -p udp -j clash
iptables -t nat -N CLASH_DNS
iptables -t nat -F CLASH_DNS 
iptables -t nat -A CLASH_DNS -p udp -j REDIRECT --to-port <span class="m">1053</span>
iptables -t nat -I OUTPUT -p udp --dport <span class="m">53</span> -j CLASH_DNS
iptables -t nat -I PREROUTING -p udp --dport <span class="m">53</span> -j REDIRECT --to <span class="m">1053</span>
iptables -t nat -A CLASH -d 240.0.0.0/4 -j RETURN
</code></pre></td></tr></table>
</div>
</div>]]></description>
</item></channel>
</rss>
