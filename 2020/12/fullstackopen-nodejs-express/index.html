<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 03 - ç”¨ NodeJS å’Œ Express å†™æœåŠ¡ç«¯ç¨‹åº - Î›.W.log</title><meta name="Description" content="æœ¬æ–‡æ˜¯åšä¸»å­¦ä¹ èµ«å°”è¾›åŸºå¤§å­¦çš„ å…¨æ ˆå…¬å¼€è¯¾2020 è¿‡ç¨‹ä¸­çš„å­¦ä¹ ç¬”è®°ï¼Œæ–‡ç« åˆ†ç±»ç»“æ„ä¸è¯¾ç¨‹ä¼šæœ‰äº›è®¸ä¸åŒï¼Œæœ¬æ–‡éƒ¨åˆ†å†…å®¹å¼•ç”¨è‡ªåŸæ–‡ã€‚"><meta property="og:title" content="å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 03 - ç”¨ NodeJS å’Œ Express å†™æœåŠ¡ç«¯ç¨‹åº" />
<meta property="og:description" content="æœ¬æ–‡æ˜¯åšä¸»å­¦ä¹ èµ«å°”è¾›åŸºå¤§å­¦çš„ å…¨æ ˆå…¬å¼€è¯¾2020 è¿‡ç¨‹ä¸­çš„å­¦ä¹ ç¬”è®°ï¼Œæ–‡ç« åˆ†ç±»ç»“æ„ä¸è¯¾ç¨‹ä¼šæœ‰äº›è®¸ä¸åŒï¼Œæœ¬æ–‡éƒ¨åˆ†å†…å®¹å¼•ç”¨è‡ªåŸæ–‡ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://x.awo.design/2020/12/fullstackopen-nodejs-express/" /><meta property="og:image" content="https://x.awo.design/img/W.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-09T17:30:00+08:00" />
<meta property="article:modified_time" content="2020-12-09T17:30:00+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://x.awo.design/img/W.jpg"/>

<meta name="twitter:title" content="å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 03 - ç”¨ NodeJS å’Œ Express å†™æœåŠ¡ç«¯ç¨‹åº"/>
<meta name="twitter:description" content="æœ¬æ–‡æ˜¯åšä¸»å­¦ä¹ èµ«å°”è¾›åŸºå¤§å­¦çš„ å…¨æ ˆå…¬å¼€è¯¾2020 è¿‡ç¨‹ä¸­çš„å­¦ä¹ ç¬”è®°ï¼Œæ–‡ç« åˆ†ç±»ç»“æ„ä¸è¯¾ç¨‹ä¼šæœ‰äº›è®¸ä¸åŒï¼Œæœ¬æ–‡éƒ¨åˆ†å†…å®¹å¼•ç”¨è‡ªåŸæ–‡ã€‚"/>
<meta name="application-name" content="Î›.W.log">
<meta name="apple-mobile-web-app-title" content="Î›.W.log"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://x.awo.design/2020/12/fullstackopen-nodejs-express/" /><link rel="prev" href="https://x.awo.design/2020/11/fullstackopen-server/" /><link rel="next" href="https://x.awo.design/2021/01/annual-report-2020/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.055364f5be272caa092b0e6654c165828707f8ab971e2656383a6d6392bc345e.css" integrity="sha256-BVNk9b4nLKoJKw5mVMFlgocH&#43;KuXHiZWODptY5K8NF4="><link rel="stylesheet" href="/css/style.min.1e2694bed152fa2922dbe909a441838ed693d88b1330f97485bfa8ed78da42df.css" integrity="sha256-HiaUvtFS&#43;iki2&#43;kJpEGDjtaT2IsTMPl0hb&#43;o7XjaQt8="><link rel="stylesheet" href="/lib/fontawesome-free/all.min.876d023d9d10c97941b80c3b03e2a5b94631ff7a4af9cee5604a6a2d39718d84.css" integrity="sha256-h20CPZ0QyXlBuAw7A&#43;KluUYx/3pK&#43;c7lYEpqLTlxjYQ="><link rel="stylesheet" href="/lib/animate/animate.min.3c770e90f98eb21b0c042fafb49755af93306fbaf42e449524f94fae9fc83295.css" integrity="sha256-PHcOkPmOshsMBC&#43;vtJdVr5Mwb7r0LkSVJPlPrp/IMpU="><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 03 - ç”¨ NodeJS å’Œ Express å†™æœåŠ¡ç«¯ç¨‹åº",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/x.awo.design\/2020\/12\/fullstackopen-nodejs-express\/"
        },"genre": "posts","keywords": "React, JavaScript","wordcount":  7899 ,
        "url": "https:\/\/x.awo.design\/2020\/12\/fullstackopen-nodejs-express\/","datePublished": "2020-12-09T17:30:00+08:00","dateModified": "2020-12-09T17:30:00+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "imagicw"
            },"description": "æœ¬æ–‡æ˜¯åšä¸»å­¦ä¹ èµ«å°”è¾›åŸºå¤§å­¦çš„ å…¨æ ˆå…¬å¼€è¯¾2020 è¿‡ç¨‹ä¸­çš„å­¦ä¹ ç¬”è®°ï¼Œæ–‡ç« åˆ†ç±»ç»“æ„ä¸è¯¾ç¨‹ä¼šæœ‰äº›è®¸ä¸åŒï¼Œæœ¬æ–‡éƒ¨åˆ†å†…å®¹å¼•ç”¨è‡ªåŸæ–‡ã€‚"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Î›.W.log">ğŸ› A.W.Log</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ‰€æœ‰æ–‡ç«  </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><a class="menu-item" href="/categories/notes"> ç¬”è®° </a><a class="menu-item" href="/books/"> é˜…è¯» </a><a class="menu-item" href="/games/"> æ¸¸æˆ </a><a class="menu-item" href="/drummer/"> é¼“æ‰‹ </a><a class="menu-item" href="/10000/"> ä¸€ä¸‡æ¬¡æ‚²ä¼¤ </a><a class="menu-item" href="/about/"> å…³äº </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Î›.W.log">ğŸ› A.W.Log</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ‰€æœ‰æ–‡ç« </a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a class="menu-item" href="/categories/notes" title="">ç¬”è®°</a><a class="menu-item" href="/books/" title="">é˜…è¯»</a><a class="menu-item" href="/games/" title="">æ¸¸æˆ</a><a class="menu-item" href="/drummer/" title="">é¼“æ‰‹</a><a class="menu-item" href="/10000/" title="">ä¸€ä¸‡æ¬¡æ‚²ä¼¤</a><a class="menu-item" href="/about/" title="">å…³äº</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 03 - ç”¨ NodeJS å’Œ Express å†™æœåŠ¡ç«¯ç¨‹åº</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://awo.design" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>imagicw</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/notes/"><i class="far fa-folder fa-fw"></i>ç¬”è®°</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-12-09">2020-12-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 7899 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 16 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#nodejs-ä¸-express">Node.js ä¸ Express</a>
          <ul>
            <li><a href="#ç®€æ˜“æœåŠ¡å™¨">ç®€æ˜“æœåŠ¡å™¨</a></li>
            <li><a href="#web-and-express">Web and express</a></li>
            <li><a href="#nodemon">nodemon</a></li>
            <li><a href="#rest">REST</a></li>
            <li><a href="#fetching-a-single-resource-è·å–ä¸€ä¸ªå•ä¸€èµ„æº">Fetching a single resource è·å–ä¸€ä¸ªå•ä¸€èµ„æº</a></li>
            <li><a href="#deleting-resources-åˆ é™¤èµ„æº">Deleting Resources åˆ é™¤èµ„æº</a></li>
            <li><a href="#receiving-data-æ¥æ”¶æ•°æ®">Receiving data æ¥æ”¶æ•°æ®</a></li>
            <li><a href="#about-http-request-types">About HTTP request types</a>
              <ul>
                <li><a href="#å®‰å…¨safety">å®‰å…¨ã€Œsafetyã€</a></li>
                <li><a href="#å¹‚ç­‰idempotencehttpsdevelopermozillaorgzh-cndocsglossarye5b982e7ad89"><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/%E5%B9%82%E7%AD%89">å¹‚ç­‰ã€Œidempotenceã€</a></a></li>
              </ul>
            </li>
            <li><a href="#middleware-ä¸­é—´ä»¶">Middleware ä¸­é—´ä»¶</a></li>
          </ul>
        </li>
        <li><a href="#å°†åº”ç”¨éƒ¨ç½²åˆ°ç½‘ä¸Š">å°†åº”ç”¨éƒ¨ç½²åˆ°ç½‘ä¸Š</a>
          <ul>
            <li><a href="#same-origin-policy-and-cors-åŒæºæ”¿ç­–å’Œ-cors">Same origin policy and CORS åŒæºæ”¿ç­–å’Œ CORS</a></li>
            <li><a href="#application-to-the-internet-å°†åº”ç”¨éƒ¨ç½²åˆ°ç½‘ä¸Š">Application to the Internet å°†åº”ç”¨éƒ¨ç½²åˆ°ç½‘ä¸Š</a></li>
            <li><a href="#frontend-production-build-å‰ç«¯ç”Ÿäº§æ„å»º">Frontend production build å‰ç«¯ç”Ÿäº§æ„å»º</a></li>
            <li><a href="#serving-static-files-from-the-backend-ä»åç«¯æœåŠ¡éƒ¨ç½²é™æ€æ–‡ä»¶">Serving static files from the backend ä»åç«¯æœåŠ¡éƒ¨ç½²é™æ€æ–‡ä»¶</a></li>
            <li><a href="#streamlining-deploying-of-the-frontend-æµç¨‹åŒ–å‰ç«¯éƒ¨ç½²">Streamlining deploying of the frontend æµç¨‹åŒ–å‰ç«¯éƒ¨ç½²</a></li>
            <li><a href="#proxy-ä»£ç†">Proxy ä»£ç†</a></li>
          </ul>
        </li>
        <li><a href="#å°†æ•°æ®å­˜å…¥-mongodb">å°†æ•°æ®å­˜å…¥ MongoDB</a>
          <ul>
            <li><a href="#debugging-node-applications-è°ƒè¯•-node-åº”ç”¨">Debugging Node applications è°ƒè¯• Node åº”ç”¨</a></li>
            <li><a href="#mongodb">MongoDB</a></li>
            <li><a href="#schema">Schema</a></li>
            <li><a href="#creating-and-saving-objects-åˆ›å»ºå’Œä¿å­˜å¯¹è±¡">Creating and saving objects åˆ›å»ºå’Œä¿å­˜å¯¹è±¡</a></li>
            <li><a href="#fetching-objects-from-the-database-ä»æœåŠ¡å™¨è·å–å¯¹è±¡">Fetching objects from the database ä»æœåŠ¡å™¨è·å–å¯¹è±¡</a></li>
            <li><a href="#backend-connected-to-a-database-åç«¯è¿æ¥åˆ°æ•°æ®åº“">Backend connected to a database åç«¯è¿æ¥åˆ°æ•°æ®åº“</a></li>
            <li><a href="#database-configuration-into-its-own-module-æ•°æ®åº“é€»è¾‘é…ç½®åˆ°å•ç‹¬çš„æ¨¡å—">Database configuration into its own module æ•°æ®åº“é€»è¾‘é…ç½®åˆ°å•ç‹¬çš„æ¨¡å—</a></li>
            <li><a href="#using-database-in-route-handlers-åœ¨è·¯ç”±å¤„ç†ç¨‹åºä¸­ä½¿ç”¨æ•°æ®åº“">Using database in route handlers åœ¨è·¯ç”±å¤„ç†ç¨‹åºä¸­ä½¿ç”¨æ•°æ®åº“</a></li>
            <li><a href="#verifying-frontend-and-backend-integration-éªŒè¯å‰ç«¯å’Œåç«¯çš„é›†æˆ">Verifying frontend and backend integration éªŒè¯å‰ç«¯å’Œåç«¯çš„é›†æˆ</a></li>
            <li><a href="#error-handling-é”™è¯¯å¤„ç†">Error handling é”™è¯¯å¤„ç†</a></li>
            <li><a href="#moving-error-handling-into-middleware-å°†é”™è¯¯å¤„ç†ç§»å…¥ä¸­é—´ä»¶">Moving error handling into middleware å°†é”™è¯¯å¤„ç†ç§»å…¥ä¸­é—´ä»¶</a></li>
            <li><a href="#the-order-of-middleware-loading-ä¸­é—´ä»¶åŠ è½½çš„é¡ºåº">The order of middleware loading ä¸­é—´ä»¶åŠ è½½çš„é¡ºåº</a></li>
            <li><a href="#other-operations-å…¶ä»–æ“ä½œ">Other operations å…¶ä»–æ“ä½œ</a></li>
          </ul>
        </li>
        <li><a href="#eslint-ä¸ä»£ç æ£€æŸ¥">ESLint ä¸ä»£ç æ£€æŸ¥</a>
          <ul>
            <li><a href="#promise-chaining-æ‰¿è¯ºé“¾">Promise chaining æ‰¿è¯ºé“¾</a></li>
            <li><a href="#deploying-the-database-backend-to-production-å°†æ•°æ®åº“åç«¯éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ">Deploying the database backend to production å°†æ•°æ®åº“åç«¯éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ</a></li>
            <li><a href="#lint">Lint</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h3 id="nodejs-ä¸-express">Node.js ä¸ Express</h3>
<p>å‰ç«¯æµè§ˆå™¨è¿˜ä¸æ”¯æŒ JavaScript çš„æœ€æ–°ç‰¹æ€§ï¼Œæ‰€ä»¥åœ¨æµè§ˆå™¨è¿è¡Œçš„ä»£ç æ˜¯ <a href="https://babeljs.io/" target="_blank" rel="noopener noreffer">babel</a> è½¬è¯‘è¿‡çš„ï¼Œè€Œåœ¨åç«¯è¿è¡Œ JavaScript çš„æƒ…å†µæ˜¯ä½¿ç”¨ Node ï¼Œè€Œ Node æ”¯æŒå¤§éƒ¨åˆ†æœ€æ–°çš„ JavaScript ç‰¹æ€§ï¼Œæ‰€ä»¥åç«¯ä»£ç ä¸éœ€è¦è½¬è¯‘ã€‚</p>
<p>npm æ¥æºäº Node ç”Ÿæ€ï¼Œæ˜¯ç®¡ç† JavaScript åŒ…çš„å·¥å…·ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µåœ¨ç»ˆç«¯ä½¿ç”¨ <code>node index.js</code> å³å¯å¯åŠ¨é¡¹ç›®ï¼Œä½†æœ€å¥½çš„åšæ³•æ˜¯åœ¨é¡¹ç›®çš„ <code>package.json</code> ä¸­å®šä¹‰è„šæœ¬ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;script&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;start&#34;</span><span class="p">:</span> <span class="s2">&#34;node index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹ååªè¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä½¿ç”¨ <code>npm start</code> å³å¯å¯ç”¨é¡¹ç›®ã€‚</p>
<h4 id="ç®€æ˜“æœåŠ¡å™¨">ç®€æ˜“æœåŠ¡å™¨</h4>
<p>è¯¥éƒ¨åˆ†ä»…ä½œäº†è§£å³å¯ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­è¿™æ ·çš„æ–¹å¼å¤ªéº»çƒ¦ã€‚ä¸»æµçš„æ–¹å¼æ˜¯ä½¿ç”¨ä¾‹å¦‚ Express è¿™ç±»çš„åº“ã€‚</p>
<p>æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œåœ¨æ ¹ç›®å½•ä½¿ç”¨ <code>npm init</code> æ¥åˆå§‹åŒ–é¡¹ç›®ï¼Œåˆ›å»º <code>index.js</code> ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">3001</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`æœåŠ¡å™¨è¿è¡Œåœ¨ </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb"> ç«¯å£`</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ <code>npm start</code> å³å¯å¯åŠ¨æœåŠ¡å™¨ï¼Œé€šè¿‡æµè§ˆå™¨å³å¯è®¿é—® http://localhost:3001ã€‚</p>
<p>å¦‚æœåŠ¡å™¨æä¾›çš„æ•°æ®æ˜¯ jsonï¼Œéœ€è¦å°† <code>Content-Type</code> æ”¹ä¸º <code>application/json</code>ã€‚è¾“å‡ºçš„æ•°ç»„éœ€è¦è¿›è¡Œ <code>JSON.stringify(array)</code> å¤„ç†ã€‚</p>
<p>Node.js ä½¿ç”¨äº† <a href="https://en.wikipedia.org/wiki/CommonJS" target="_blank" rel="noopener noreffer">CommonJS</a>ï¼Œè¿˜ä¸æ”¯æŒ ES6 æ¨¡å—ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ <code>import http from 'http'</code>ã€‚</p>
<h4 id="web-and-express">Web and express</h4>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•å®‰è£… <code>npm install express</code>ã€‚å› ä¸ºä½¿ç”¨äº† <code>npm</code> æ¥å®‰è£…ï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨åœ¨é¡¹ç›® <code>package.json</code> æ·»åŠ  <code>express</code> ä¾èµ–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;express&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.17.1&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>^4.17.1</code> é™åˆ¶äº†è¯¥é¡¹ç›®æ”¯æŒçš„ <code>express</code> çš„æœ€ä½ç‰ˆæœ¬ã€‚</p>
<p>è®©åŸå…ˆ <code>index.js</code> ä½¿ç”¨ <code>express</code> åº“ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">notes</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å®šä¹‰è·¯ç”±
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¤„ç†å¯¹åº”ç”¨ &#39;/&#39; çš„ HTTP GET è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// response å“åº”è¯·æ±‚ï¼Œè¿”å› &lt;h1&gt;Hello World!&lt;/h1&gt;ã€‚express ä¼šè‡ªåŠ¨è®¾ç½® Content-Type ä¸º text/htmlï¼ŒçŠ¶æ€ç  200
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;&lt;h1&gt;Hello World!&lt;/h1&gt;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å¤„ç†å¯¹åº”ç”¨ &#39;/api/notes&#39; çš„ HTTP GET è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/notes&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// response å“åº”è¯·æ±‚ï¼Œè¿”å› json æ•°æ®ã€‚express ä¼šè‡ªåŠ¨è®¾ç½® Content-Type ä¸º application/jsonï¼ŒçŠ¶æ€ç  200
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">notes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æœåŠ¡å™¨è¿è¡Œç«¯å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">3001</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`æœåŠ¡å™¨è¿è¡Œåœ¨ </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb"> ç«¯å£`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="nodemon">nodemon</h4>
<p>é€šè¿‡ä½¿ç”¨ <code>nodemon</code>ï¼Œå¯ä»¥ä½¿åº”ç”¨åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç”±äºä»£ç çš„ä¿®æ”¹è€Œè‡ªåŠ¨é‡å¯æœåŠ¡ï¼Œä»è€Œé¿å…æ¯æ¬¡ä¿®æ”¹å®Œä»£ç åéƒ½éœ€è¦é‡æ–° <code>npm start</code> é¡¹ç›®ã€‚</p>
<p>é€šè¿‡ <code>npm install nodemon --save-dev</code> åœ¨é¡¹ç›®ä¸­æ·»åŠ å¼€å‘ä¾èµ–ï¼Œä¼šåœ¨ <code>package.json</code> çš„å¼€å‘ä¾èµ–ä¸­å®šä¹‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;express&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.17.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;devDependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;nodemon&#34;</span><span class="p">:</span> <span class="s2">&#34;^2.0.2&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¼€å‘ä¾èµ–æ˜¯åœ¨å¼€å‘æ—¶éœ€è¦ç”¨åˆ°çš„è€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”¨ä¸åˆ°çš„ä¾èµ–ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•è¿˜æ˜¯åœ¨ <code>package.json</code> çš„å¢åŠ è„šæœ¬ï¼Œè€Œåé€šè¿‡ <code>npm run dev</code> æ¥å¯åŠ¨ï¼Œè¿™äº <code>start</code> å’Œ <code>test</code> ä¸åŒï¼Œéœ€è¦åœ¨å‘½ä»¤ä¸­åŠ å…¥ <code>run</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ..
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;start&#34;</span><span class="p">:</span> <span class="s2">&#34;node index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="s2">&#34;nodemon index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;test&#34;</span><span class="p">:</span> <span class="s2">&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ..
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="rest">REST</h4>
<blockquote>
<p>åœ¨ RESTful thinking ä¸­ç§°ä¸º resourceã€‚ æ¯ä¸ª resource éƒ½æœ‰ä¸€ä¸ªç›¸å…³è”çš„ URLï¼Œè¿™ä¸ª URL æ˜¯èµ„æºçš„å”¯ä¸€åœ°å€ã€‚</p>
<p>ä¸€ä¸ªçº¦å®šæ˜¯ç»“åˆ resource ç±»å‹åç§°å’Œ resource çš„å”¯ä¸€æ ‡è¯†ç¬¦æ¥åˆ›å»º resource å”¯ä¸€çš„åœ°å€ã€‚</p>
</blockquote>
<p>å‡è®¾æ ¹ç›®å½•ä¸º <code>/api</code>ï¼Œé‚£ä¹ˆç¬”è®°çš„é›†åˆåˆ™æ˜¯ <code>/api/notes</code> ï¼Œå•ä¸ªç¬”è®°åˆ™æ˜¯ <code>/api/notes/10</code>ã€‚</p>
<p>å¯¹èµ„æºåˆå¯ä»¥è¿›è¡Œä¸åŒçš„æ“ä½œï¼Œä»¥ä¸‹è¡¨æ ¼å¯ä»¥ç²—ç•¥åœ°å®šä¹‰ä¸º REST æ‰€æŒ‡çš„ <a href="https://en.wikipedia.org/wiki/Representational_state_transfer#Architectural_constraints" target="_blank" rel="noopener noreffer">ç»Ÿä¸€æ¥å£ uniform interface</a>ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">URL</th>
<th style="text-align:left">Verb</th>
<th style="text-align:left">functionality</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">notes</td>
<td style="text-align:left">GET</td>
<td style="text-align:left">è·å–æ•´ä¸ª resources é›†åˆ</td>
</tr>
<tr>
<td style="text-align:left">notes</td>
<td style="text-align:left">POST</td>
<td style="text-align:left">æ ¹æ® request çš„æ•°æ®åˆ›å»ºæ–° resource</td>
</tr>
<tr>
<td style="text-align:left">notes/10</td>
<td style="text-align:left">GET</td>
<td style="text-align:left">è·å–æŒ‡å®šçš„ resource</td>
</tr>
<tr>
<td style="text-align:left">notes/10</td>
<td style="text-align:left">DELETE</td>
<td style="text-align:left">åˆ é™¤æŒ‡å®šçš„ resource</td>
</tr>
<tr>
<td style="text-align:left">notes/10</td>
<td style="text-align:left">PUT</td>
<td style="text-align:left">æ ¹æ® request çš„æ•°æ®ä¿®æ”¹æŒ‡å®šçš„æ•´ä¸ª resource</td>
</tr>
<tr>
<td style="text-align:left">notes/10</td>
<td style="text-align:left">PATCH</td>
<td style="text-align:left">æ ¹æ® request çš„æ•°æ®ä¿®æ”¹æŒ‡å®šçš„ resource çš„éƒ¨åˆ†æ•°æ®</td>
</tr>
</tbody>
</table>
<p><em>REST API å¯ä»¥å½“ä½œä¸ºæ˜¯ä¸€ç§çº¦å®šï¼Œè€Œéä¸€ç§æ ‡å‡†</em>ï¼Œä¸–ç•Œä¸Šå¤§å¤šæ•° REST API éƒ½ä¸ç¬¦åˆ Fielding åœ¨å…¶è®ºæ–‡ä¸­æ¦‚è¿°çš„åŸå§‹æ ‡å‡†ã€‚æ‰€ä»¥åœ¨ç¼–å†™ API æ—¶è¦æœ‰ä¸€è‡´æ€§ï¼Œä»¥ä¾¿ç³»ç»Ÿè¿›è¡Œåˆä½œã€‚</p>
<h4 id="fetching-a-single-resource-è·å–ä¸€ä¸ªå•ä¸€èµ„æº">Fetching a single resource è·å–ä¸€ä¸ªå•ä¸€èµ„æº</h4>
<p>æˆ‘ä»¬çº¦å®šçš„å•ä¸ªç¬”è®°çš„å”¯ä¸€åœ°å€æ˜¯ <code>notes/10</code>ï¼Œå…¶ä¸­ 10 æ˜¯ç¬”è®°çš„å”¯ä¸€ id å·ã€‚é€šè¿‡å†’å·è¯­æ³•ä¸ºè·¯ç”±å®šä¹‰å‚æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// å¤„ç†å¯¹åº” api/notes/id çš„è·¯ç”±ï¼Œå…¶ä¸­ id å¯ä»¥ä¸ºä»»æ„å­—ç¬¦ä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/notes/:id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ä» request ä¸­è·å¾— id å‚æ•°ï¼Œå¹¶å°† id æ›´æ”¹ä¸º number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">note</span> <span class="o">=</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">note</span> <span class="p">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ç¬”è®°ä¸å­˜åœ¨åˆ™è¿”å› 404 çŠ¶æ€ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">end</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="deleting-resources-åˆ é™¤èµ„æº">Deleting Resources åˆ é™¤èµ„æº</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/api/notes/:id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">notes</span> <span class="o">=</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="p">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// è¿”å› 204 çŠ¶æ€ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">204</span><span class="p">).</span><span class="nx">end</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="receiving-data-æ¥æ”¶æ•°æ®">Receiving data æ¥æ”¶æ•°æ®</h4>
<p>å‘ <code>/api/notes</code> å‘é€ HTTP POST è¯·æ±‚ï¼Œå¹¶ä»¥ JSON æ ¼å¼åœ¨ request body ä¸­å‘é€æ–°ç¬”è®°çš„ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨åˆ° express json-parserï¼Œå®ƒä¸å‘½ä»¤ <code>app.use(express.json())</code> ä¸€èµ·ä½¿ç”¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">generateId</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">maxId</span> <span class="o">=</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="o">?</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(...</span><span class="nx">notes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">note</span> <span class="p">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span> <span class="c1">// ä½¿ç”¨å±•å¼€è¯­æ³•å°† notes ä¸­æ‰€æœ‰çš„ id éƒ½å±•å¼€å‡ºæ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">maxId</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/notes&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä½¿ç”¨ return è¿”å› 400 çŠ¶æ€ç ä»¥åŠé”™è¯¯æç¤ºå¹¶é˜»æ­¢ä»£ç ç»§ç»­æ‰§è¡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;å†…å®¹ç¼ºå¤±&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">note</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">content</span><span class="o">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">important</span><span class="o">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">important</span> <span class="o">||</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">id</span><span class="o">:</span> <span class="nx">generateId</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">notes</span> <span class="o">=</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åƒ DELETEã€POST ç­‰æ“ä½œï¼Œåœ¨æµè§ˆå™¨ä¸Šä¸æ˜¯å¾ˆæ–¹ä¾¿æ‰§è¡Œï¼Œä½¿ç”¨ Postman åº”ç”¨æˆ–è€… VS Code REST client æ’ä»¶æ¥æ“ä½œå³å¯ã€‚</p>
<p>å¦‚æœ POST è¯·æ±‚å‡ºç°é”™è¯¯ï¼Œéœ€è¦æ£€æŸ¥ Postman æˆ–è€… REST client æ’ä»¶æ˜¯å¦å°† POST æ•°æ®çš„ <code>Content-Type</code> è®¾ç½®ä¸º <code>application/json</code>ã€‚</p>
<h4 id="about-http-request-types">About HTTP request types</h4>
<p>HTTP æ ‡å‡†è®¨è®ºäº†ä¸è¯·æ±‚ç±»å‹ç›¸å…³çš„ä¸¤ä¸ªå±æ€§ï¼Œå®‰å…¨ã€Œsafetyã€ å’Œ å¹‚ç­‰æ€§ã€Œidempotenceã€ ã€‚</p>
<h5 id="å®‰å…¨safety">å®‰å…¨ã€Œsafetyã€</h5>
<p>HTTP GET è¯·æ±‚åº”è¯¥æ˜¯æ»¡è¶³å®‰å…¨æ€§çš„ï¼š</p>
<blockquote>
<p>In particular, the convention has been established that the GET and HEAD methods SHOULD NOT have the significance of taking an action other than retrieval. These methods ought to be considered &ldquo;safe&rdquo;.</p>
</blockquote>
<p>å®‰å…¨æ€§æ„å‘³ç€æ‰§è¡Œè¯·æ±‚ä¸èƒ½åœ¨æœåŠ¡å™¨ä¸­å¼•èµ·ä»»ä½•<strong>å‰¯ä½œç”¨ã€Œside effectã€</strong>ã€‚ å‰¯ä½œç”¨æ˜¯æŒ‡æ•°æ®åº“çš„çŠ¶æ€<strong>ä¸èƒ½å› è¯·æ±‚è€Œæ”¹å˜</strong>ï¼Œå“åº”<strong>åªèƒ½</strong>è¿”å›æœåŠ¡å™¨ä¸Šå·²ç»å­˜åœ¨çš„æ•°æ®ã€‚</p>
<p>æ— æ³•ä¿è¯ GET è¯·æ±‚æ˜¯å®‰å…¨çš„ï¼Œè¿™å®é™…ä¸Šæ˜¯ HTTP æ ‡å‡†çš„å»ºè®®ã€‚é€šè¿‡éµå®ˆ API ä¸­çš„ RESTful åŸåˆ™ï¼ŒGET è¯·æ±‚å®é™…ä¸Šæ€»æ˜¯ä»¥ä¸€ç§å®‰å…¨çš„æ–¹å¼ä½¿ç”¨ã€‚</p>
<p>HTTP æ ‡å‡†è¿˜å®šä¹‰äº† <a href="https://www.w3.org/protocols/rfc2616/rfc2616-sec9.html#sec9.4" target="_blank" rel="noopener noreffer">HEAD</a>ï¼Œ å®é™…ä¸Šï¼ŒHEAD åº”è¯¥åƒ GET ä¸€æ ·å·¥ä½œï¼Œä½†æ˜¯å®ƒåªè¿”å›çŠ¶æ€ç å’Œå“åº”å¤´ã€‚ å½“æ‚¨å‘å‡º HEAD è¯·æ±‚æ—¶ï¼Œä¸ä¼šè¿”å›å“åº”ä¸»ä½“ã€‚</p>
<h5 id="å¹‚ç­‰idempotencehttpsdevelopermozillaorgzh-cndocsglossarye5b982e7ad89"><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/%E5%B9%82%E7%AD%89" target="_blank" rel="noopener noreffer">å¹‚ç­‰ã€Œidempotenceã€</a></h5>
<p>é™¤äº† POST ä»¥å¤–çš„æ‰€æœ‰ HTTP è¯·æ±‚éƒ½æ˜¯å¹‚ç­‰çš„ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚æœ‰å‰¯ä½œç”¨ï¼Œé‚£ä¹ˆæ— è®ºå‘é€å¤šå°‘æ¬¡è¯·æ±‚ï¼Œç»“æœéƒ½åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚</p>
<blockquote>
<p>Methods can also have the property of &ldquo;idempotence&rdquo; in that (aside from error or expiration issues) the side-effects of N &gt; 0 identical requests is the same as for a single request. The methods GET, HEAD, PUT and DELETE share this property.</p>
</blockquote>
<p>POST æ˜¯å”¯ä¸€çš„ä¸å®‰å…¨ä¹Ÿä¸å¹‚ç­‰çš„ HTTP è¯·æ±‚ç±»å‹ã€‚å‘é€å¤šä¸ª POST è¯·æ±‚ï¼Œå¯ä»¥äº§ç”Ÿå¤šæ¡å†…å®¹ã€‚</p>
<h4 id="middleware-ä¸­é—´ä»¶">Middleware ä¸­é—´ä»¶</h4>
<p>ä¸­é—´ä»¶æ˜¯å¯ç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”å¯¹è±¡çš„å‡½æ•°ã€‚å¯ä»¥ä»è¯·æ±‚å¯¹è±¡ä¸­å­˜å‚¨çš„è¯·æ±‚ä¸­è·å–åŸå§‹æ•°æ®ï¼Œå°†å…¶è§£æä¸ºä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸€ä¸ªæ–°çš„å±æ€§ã€body åˆ†é…ç»™è¯·æ±‚å¯¹è±¡ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨å¤šä¸ªä¸­é—´ä»¶ï¼Œä¼šæŒ‰ç…§é¡ºåºä¸€ä¸ªä¸€ä¸ªåœ°æ‰§è¡Œã€‚</p>
<p>ä¸­é—´ä»¶æ˜¯ä¸€ä¸ªæ¥æ”¶ä¸‰ä¸ªå‚æ•°çš„å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">requestLogger</span> <span class="o">=</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Method: &#39;</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Path: &#39;</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Body: &#39;</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="p">()</span> <span class="c1">// è°ƒç”¨ä½œä¸ºå‚æ•°ä¼ é€’çš„ä¸‹ä¸€ä¸ªå‡½æ•°ã€‚ å‡½æ•°å°†æ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span> <span class="c1">// è·å¾— body å†…å®¹ï¼Œä¿è¯ requestLogger èƒ½å¤Ÿå¾—åˆ° request.body å†…å®¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">requestLogger</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸­é—´ä»¶å‡½æ•°æŒ‰ç…§ä¸ express æœåŠ¡å™¨å¯¹è±¡çš„ä½¿ç”¨æ–¹æ³•ä¸€èµ·ä½¿ç”¨çš„é¡ºåºè°ƒç”¨ã€‚ å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨è°ƒç”¨è·¯ç”±äº‹ä»¶å¤„ç†ç¨‹åºä¹‹å‰æ‰§è¡Œè·¯ç”±ï¼Œåˆ™å¿…é¡»åœ¨è·¯ç”±ä¹‹å‰ä½¿ç”¨ä¸­é—´ä»¶å‡½æ•°ã€‚ç›¸åçš„ï¼Œä¸­é—´ä»¶å‡½æ•°æ”¾åœ¨è·¯ç”±ä¹‹åï¼Œä½¿ä¸­é—´ä»¶åœ¨æ²¡æœ‰è·¯ç”±å¤„ç† HTTP è¯·æ±‚çš„æ—¶å€™è°ƒç”¨ã€‚</p>
<h3 id="å°†åº”ç”¨éƒ¨ç½²åˆ°ç½‘ä¸Š">å°†åº”ç”¨éƒ¨ç½²åˆ°ç½‘ä¸Š</h3>
<h4 id="same-origin-policy-and-cors-åŒæºæ”¿ç­–å’Œ-cors">Same origin policy and CORS åŒæºæ”¿ç­–å’Œ CORS</h4>
<blockquote>
<p>Cross-origin resource sharing (CORS) is a mechanism that allows restricted resources (e.g. fonts) on a web page to be requested from another domain outside the domain from which the first resource was served. A web page may freely embed cross-origin images, stylesheets, scripts, iframes, and videos. Certain &ldquo;cross-domain&rdquo; requests, notably Ajax requests, are forbidden by default by the same-origin security policy. Cross-origin resource sharing.</p>
<p><em>â€”â€” ç»´åŸºç™¾ç§‘</em></p>
</blockquote>
<p><a href="https://developer.mozilla.org/en-us/docs/web/security/same-origin_policy" target="_blank" rel="noopener noreffer">åŒæºç­–ç•¥</a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener noreffer">CORS</a> æ˜¯ Web åº”ç”¨çš„é€šç”¨åŸåˆ™ã€‚</p>
<p>åœ¨ Node é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨ <code>cors</code> ä¸­é—´ä»¶æ¥å…è®¸æ¥è‡ªå…¶ä»–çš„è¯·æ±‚ã€‚</p>
<p>é€šè¿‡ <code>npm install cors</code> æ¥å®‰è£…ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cors&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="application-to-the-internet-å°†åº”ç”¨éƒ¨ç½²åˆ°ç½‘ä¸Š">Application to the Internet å°†åº”ç”¨éƒ¨ç½²åˆ°ç½‘ä¸Š</h4>
<p>ä½¿ç”¨ <a href="https://www.heroku.com/" target="_blank" rel="noopener noreffer">Heroku</a> æ¥éƒ¨ç½²åº”ç”¨ã€‚</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º <code>Procfile</code> æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å†…å¡«å†™ <code>web: npm start</code> æ¥å‘Šè¯‰ Heroku å¦‚ä½•å¯åŠ¨åº”ç”¨ã€‚</p>
<p>å°†åº”ç”¨çš„ <code>index.js</code> ä¸­ç«¯å£æ”¹ä¸ºç¯å¢ƒå˜é‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3001</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨åº”ç”¨å†…åˆ›å»º git ä»“åº“ï¼Œå¹¶ä½¿ç”¨ git æ–¹å¼æˆ–è€… ssh æ–¹å¼å°†åº”ç”¨éƒ¨ç½²è‡³ Heroku ä¸Šï¼Œæ–¹æ³•åŒå…¶ä»– git æ–¹å¼ï¼ŒVS code é›†æˆäº† git åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>git push</code> æ—¶å€™ï¼Œéœ€è¦çš„æ˜¯ Heroku çš„ Access API è€Œä¸æ˜¯ç”¨æˆ·å¯†ç ã€‚</p>
<h4 id="frontend-production-build-å‰ç«¯ç”Ÿäº§æ„å»º">Frontend production build å‰ç«¯ç”Ÿäº§æ„å»º</h4>
<p>ç›®å‰ä¸ºæ­¢ï¼Œåº”ç”¨å¤„äºå¼€å‘æ¨¡å¼ä¸­è¿è¡Œï¼Œç®€è¨€ä¹‹å°±æ˜¯ã€Œäººç±»å¯è¯»ã€çš„ç¯å¢ƒï¼Œåœ¨éƒ¨ç½²åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†åº”ç”¨åˆ›å»ºä¸€ä¸ª<a href="https://zh-hans.reactjs.org/docs/optimizing-performance.html#use-the-production-build" target="_blank" rel="noopener noreffer">ç”Ÿäº§æ„å»º</a>æˆ–ä¸ºç”Ÿäº§è€Œä¼˜åŒ–çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ã€Œæœºå™¨å¯è¯»ã€çš„ç¯å¢ƒã€‚</p>
<p><code>create-react-app</code> åˆ›å»ºçš„åº”ç”¨å¯ä»¥ä½¿ç”¨ <code>npm build</code> å‘½ä»¤æ¥æ„å»ºã€‚</p>
<blockquote>
<p>é€šè¿‡åœ¨åº”ç”¨æ ¹ç›®å½•è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªåä¸ºbuild çš„ç›®å½•(å…¶ä¸­åŒ…å«åº”ç”¨ä¸­å”¯ä¸€çš„ HTML æ–‡ä»¶index. HTML) ï¼Œå…¶ä¸­åŒ…å«ç›®å½• staticã€‚ åº”ç”¨çš„ JavaScript ä»£ç çš„ <a href="https://en.wikipedia.org/wiki/minification_%28programming%29" target="_blank" rel="noopener noreffer">Minified</a> ç‰ˆæœ¬å°†ç”Ÿæˆåˆ° static ç›®å½•ã€‚ å³ä½¿åº”ç”¨ä»£ç ä½äºå¤šä¸ªæ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰çš„ JavaScript éƒ½å°†è¢«ç¼©å°åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ å®é™…ä¸Šï¼Œæ¥è‡ªæ‰€æœ‰åº”ç”¨ä¾èµ–é¡¹çš„æ‰€æœ‰ä»£ç ä¹Ÿå°†ç¼©å°åˆ°è¿™ä¸ªå•ä¸€æ–‡ä»¶ä¸­ã€‚</p>
</blockquote>
<h4 id="serving-static-files-from-the-backend-ä»åç«¯æœåŠ¡éƒ¨ç½²é™æ€æ–‡ä»¶">Serving static files from the backend ä»åç«¯æœåŠ¡éƒ¨ç½²é™æ€æ–‡ä»¶</h4>
<p>å°†å‰ç«¯æ„å»ºçš„ <code>build</code> æ–‡ä»¶å¤¹å¤åˆ¶åˆ°åç«¯åº”ç”¨çš„æ ¹ç›®å½•ï¼Œé€šè¿‡ express çš„å†…ç½®çš„ static ä¸­é—´ä»¶æ¥ç°å®å‰ç«¯æ„å»ºçš„å†…å®¹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ express æ”¶åˆ° HTTP GET è¯·æ±‚æ—¶ï¼Œå®ƒä¼šé¦–å…ˆæ£€æŸ¥ build ç›®å½•æ˜¯å¦åŒ…å«ä¸è¯·æ±‚åœ°å€å¯¹åº”çš„æ–‡ä»¶ï¼Œå¹¶è¿”å›ç›¸åº”çš„å†…å®¹ã€‚</p>
<p>è¿™æ ·çš„æ–¹å¼é‡‡ç”¨äº†å‰åç«¯åœ¨ä¸€èµ·çš„æ–¹å¼ï¼Œæ‰€ä»¥å¯ä»¥å°†å‰ç«¯çš„ <code>baseUrl</code> æ”¹æˆç›¸å¯¹è·¯å¾„ <code>/api/notes</code> å³å¯ã€‚</p>
<p>åœ¨ç¡®ä¿ç”Ÿäº§ç¯å¢ƒåœ¨æœ¬åœ°æ­£å¸¸ä¹‹åï¼Œå°†ç”Ÿäº§æ„å»º <code>git push</code> è‡³ Heroku å®Œæˆéƒ¨ç½²ã€‚</p>
<h4 id="streamlining-deploying-of-the-frontend-æµç¨‹åŒ–å‰ç«¯éƒ¨ç½²">Streamlining deploying of the frontend æµç¨‹åŒ–å‰ç«¯éƒ¨ç½²</h4>
<p>é€šè¿‡æ›´æ”¹åç«¯ <code>package.json</code> çš„ scripts æ¥å®ç°æµç¨‹åŒ–æ„å»ºï¼Œä»¥ä¸‹ç›´æ¥å¼•ç”¨äº†æ•™æå†…å®¹ï¼Œä¸€èˆ¬æ¥è¯´æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µæ¥å¡«å†™è¿™äº› scripts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nt">&#34;build:ui&#34;</span><span class="p">:</span> <span class="s2">&#34;rm -rf build &amp;&amp; cd ../../osa2/materiaali/notes-new &amp;&amp; npm run build --prod &amp;&amp; cp -r build ../../../osa3/notes-backend/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;deploy&#34;</span><span class="p">:</span> <span class="s2">&#34;git push heroku main&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;deploy:full&#34;</span><span class="p">:</span> <span class="s2">&#34;npm run build:ui &amp;&amp; git add . &amp;&amp; git commit -m uibuild &amp;&amp; npm run deploy&#34;</span><span class="p">,</span>    
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;logs:prod&#34;</span><span class="p">:</span> <span class="s2">&#34;heroku logs --tail&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="proxy-ä»£ç†">Proxy ä»£ç†</h4>
<p>åœ¨å‰ç«¯å¼€å‘æ—¶ï¼Œå› ä¸ºä¹‹å‰å°† <code>baseUrl</code> æ›´æ”¹æˆåç«¯çš„ç›¸å¯¹è·¯å¾„ï¼Œæ‰€ä»¥åœ¨å¼€å‘æ¨¡å¼è¿è¡Œå‰ç«¯å†…å®¹æ—¶ï¼Œå¹¶ä¸èƒ½è·å–åˆ°å‡†ç¡®çš„ä¸ºæ­¢ï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦é€šè¿‡ä»£ç†ï¼Œå°†ç›¸å¯¹è·¯å¾„çš„è¯·æ±‚è½¬å‘è‡³åç«¯æœåŠ¡å™¨ã€‚</p>
<p>åœ¨ <code>package.json</code> å¢åŠ  <code>proxy</code> ä»£ç†è®¾ç½®æ¥è½¬å‘ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;proxy&#34;</span><span class="p">:</span> <span class="s2">&#34;http://localhost:3001&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ–¹æ³•çš„ä¸€ä¸ªåŠ£åŠ¿ï¼Œæ˜¯å‰ç«¯éƒ¨ç½²çš„å¤æ‚ç¨‹åº¦ã€‚ éƒ¨ç½²æ–°ç‰ˆæœ¬éœ€è¦ç”Ÿæˆæ–°çš„å‰ç«¯ç”Ÿäº§æ„å»ºå¹¶å°†å…¶å¤åˆ¶åˆ°åç«¯å­˜å‚¨åº“ã€‚ è¿™ä½¿å¾—åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–çš„<a href="https://martinfowler.com/bliki/DeploymentPipeline.html" target="_blank" rel="noopener noreffer">éƒ¨ç½²ç®¡é“</a>å˜å¾—æ›´åŠ å›°éš¾ã€‚ éƒ¨ç½²ç®¡é“æ˜¯æŒ‡é€šè¿‡ä¸åŒçš„æµ‹è¯•å’Œè´¨é‡æ£€æŸ¥å°†ä»£ç ä»å¼€å‘äººå‘˜çš„è®¡ç®—æœºè½¬ç§»åˆ°ç”Ÿäº§ç¯å¢ƒçš„è‡ªåŠ¨åŒ–æ§åˆ¶çš„æ–¹æ³•ã€‚</p>
</blockquote>
<h3 id="å°†æ•°æ®å­˜å…¥-mongodb">å°†æ•°æ®å­˜å…¥ MongoDB</h3>
<h4 id="debugging-node-applications-è°ƒè¯•-node-åº”ç”¨">Debugging Node applications è°ƒè¯• Node åº”ç”¨</h4>
<p>å°†æ•°æ® <code>console.log</code> åˆ°æ§åˆ¶å°æ˜¯ä¸€ç§å¯é çš„æ–¹æ³•ã€‚</p>
<p>ä½¿ç”¨ VS Code çš„ä»£ç è°ƒè¯•å™¨ï¼Œåœ¨è½¯ä»¶çš„ Run èœå•ä¸‹é€‰æ‹© Add Configuration&hellip; æ¥é…ç½® debug çš„è®¾ç½®ï¼Œé€‰æ‹©ä»£ç ä½¿ç”¨çš„ç¯å¢ƒ Node.js ä¼šè‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œç„¶åé€‰æ‹© Start Debugging å¼€å§‹è°ƒè¯•ã€‚</p>
<p>ä½¿ç”¨ Google Dev Tools è°ƒè¯•åº”ç”¨ï¼Œåœ¨æ§åˆ¶å°ä½¿ç”¨ <code>node --inspect index.js</code> è¿›è¡Œè°ƒè¯•ï¼Œä¹Ÿå¯ä»¥åœ¨ Console æ§åˆ¶å°ç‚¹å‡» Node logo å¼€å¯ã€‚<em>ç³»ç»Ÿéœ€è¦å…¨å±€å®‰è£… Nodeï¼Œå¦‚æœåªæ˜¯åœ¨é¡¹ç›®ä¸­å®‰è£… Node æ˜¯ä½¿ç”¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¾ç¤º Node logo çš„</em></p>
<p><strong>è´¨ç–‘ä¸€åˆ‡ï¼Œå‡ºç° bug æ—¶ï¼Œé€ä¸€æ’é™¤æ‰€æœ‰çš„å¯èƒ½æ€§ï¼Œå°† bug ä¿®å¤åå†ç»§ç»­ç¼–å†™ä»£ç ã€‚</strong></p>
<h4 id="mongodb">MongoDB</h4>
<p>MongoDB ä¸åŒäº MySQL ç­‰å…¶ä»–å…³ç³»æ•°æ®åº“ï¼Œå®ƒæ—¶<a href="https://zh.wikipedia.org/wiki/%E9%9D%A2%E5%90%91%E6%96%87%E6%AA%94%E7%9A%84%E6%95%B8%E6%93%9A%E5%BA%AB" target="_blank" rel="noopener noreffer">æ–‡æ¡£æ•°æ®åº“</a>ï¼Œå®ƒé€šå¸¸è¢«å½’ç±»ä¸º <a href="https://zh.wikipedia.org/wiki/NoSQL" target="_blank" rel="noopener noreffer">NoSQL</a></p>
<p>ä½¿ç”¨ <a href="https://www.mongodb.com/cloud/Atlas" target="_blank" rel="noopener noreffer">MongoDB Atlas</a> ä¸ºåº”ç”¨æä¾›æ•°æ®å­˜å‚¨æœåŠ¡ï¼Œä¹Ÿå¯ä»¥åœ¨æœ¬åœ°åˆ›å»º MongoDBã€‚</p>
<p>ä½¿ç”¨ Mongoose åº“æ¥ä»£æ›¿ MongoDB å®˜æ–¹çš„é©±åŠ¨ç¨‹åºæ“ä½œæ•°æ®åº“ä¼šéå¸¸æ–¹ä¾¿ã€‚Mongoose å¯ä»¥è¢«æè¿°ä¸º <code>ODM(Object Document Mapper)</code>ï¼Œå®ƒå¯ä»¥éå¸¸ç®€å•çš„å°† JavaScript å¯¹è±¡ä¿å­˜ä¸º Mongo æ–‡æ¡£ã€‚</p>
<p>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ <code>npm install mongoose</code> å®‰è£… Mongooseã€‚</p>
<p>æ–°å¢ <code>mongo.js</code> ç”¨äºä¸æ•°æ®åº“çš„è¿æ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;è¯·æä¾›è¿æ¥æ•°æ®åº“çš„å¯†ç ï¼šnode mongo.js &lt;passowrd&gt;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`mongodb+srv://fullstack:</span><span class="si">${</span><span class="nx">password</span><span class="si">}</span><span class="sb">@cluster0-ostce.mongodb.net/test?retryWrites=true`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">url</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useNewUrlParser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useFindAndModify</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useCreateIndex</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥é€šè¿‡ä¿®æ”¹ url ä¸­çš„ test æ¥æ›´æ”¹æ•°æ®åº“åç§°ï¼Œå¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è¿™ä¸ªæ•°æ®åº“ï¼Œå®ƒä¼šåœ¨è¿æ¥æˆåŠŸåè‡ªåŠ¨æ·»åŠ ã€‚</p>
<h4 id="schema">Schema</h4>
<p>ä»¥ä¸‹å®šä¹‰äº†ç¬”è®°çš„ <a href="http://mongoosejs.com/docs/guide.html" target="_blank" rel="noopener noreffer">Schema</a> æ¨¡å¼å’ŒåŒ¹é…çš„ <a href="http://mongoosejs.com/docs/models.html" target="_blank" rel="noopener noreffer">Model</a> æ¨¡å‹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// mongo.js
</span></span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">noteSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">content</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">date</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">important</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Note</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Note&#39;</span><span class="p">,</span> <span class="nx">noteSchema</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Schema å‘Šè¯‰ Mongoose å¦‚ä½•å°† note å¯¹è±¡å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚</p>
<blockquote>
<p>åœ¨ Note æ¨¡å‹å®šä¹‰ä¸­ï¼Œç¬¬ä¸€ä¸ª &ldquo;Note&rdquo; å‚æ•°æ˜¯æ¨¡å‹çš„å•æ•°åã€‚é›†åˆçš„åç§°å°†æ˜¯å°å†™çš„å¤æ•° notesï¼Œå› ä¸º Mongoose çº¦å®šæ˜¯å½“æ¨¡å¼ä»¥å•æ•°ï¼ˆä¾‹å¦‚ Noteï¼‰å¼•ç”¨é›†åˆæ—¶è‡ªåŠ¨å°†å…¶å‘½åä¸ºå¤æ•°ï¼ˆä¾‹å¦‚ notesï¼‰ã€‚</p>
<p>åƒ Mongo è¿™æ ·çš„æ–‡æ¡£æ•°æ®åº“æ˜¯ schemaalessï¼Œè¿™æ„å‘³ç€æ•°æ®åº“æœ¬èº«å¹¶ä¸å…³å¿ƒå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®çš„ç»“æ„ã€‚ å¯ä»¥åœ¨åŒä¸€é›†åˆä¸­å­˜å‚¨å…·æœ‰å®Œå…¨ä¸åŒå­—æ®µçš„æ–‡æ¡£ã€‚</p>
<p>Mongoose èƒŒåçš„æ€æƒ³æ˜¯ï¼Œå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®åœ¨ application çº§åˆ«ä¸Šè¢«èµ‹äºˆä¸€ä¸ª schemaï¼Œè¯¥æ¨¡å¼å®šä¹‰äº†å­˜å‚¨åœ¨ä»»ä½•ç»™å®šé›†åˆä¸­çš„æ–‡æ¡£çš„å½¢çŠ¶ã€‚</p>
</blockquote>
<h4 id="creating-and-saving-objects-åˆ›å»ºå’Œä¿å­˜å¯¹è±¡">Creating and saving objects åˆ›å»ºå’Œä¿å­˜å¯¹è±¡</h4>
<p>åœ¨ Node Model æ¨¡å‹çš„å¸®åŠ©ä¸‹ï¼Œåˆ›å»ºæ–°çš„ Note éå¸¸ç®€å•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// mongo.js
</span></span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">note</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Note</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;æ–°çš„ note&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">date</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">important</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ¨¡å‹æ˜¯æ‰€è°“çš„æ„é€ å‡½æ•° constructor functionï¼Œå®ƒæ ¹æ®æä¾›çš„å‚æ•°åˆ›å»ºæ–°çš„ JavaScript å¯¹è±¡ã€‚ ç”±äºå¯¹è±¡æ˜¯ä½¿ç”¨æ¨¡å‹çš„æ„é€ å‡½æ•°åˆ›å»ºçš„ï¼Œå› æ­¤å®ƒä»¬å…·æœ‰æ¨¡å‹çš„æ‰€æœ‰å±æ€§ï¼Œå…¶ä¸­åŒ…æ‹¬å°†å¯¹è±¡ä¿å­˜åˆ°æ•°æ®åº“çš„æ–¹æ³•ã€‚</p>
</blockquote>
<p>é€šè¿‡ <code>save()</code> æ–¹æ³•æ¥ä¿å­˜æ–°çš„ <code>note</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// mongo.js
</span></span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">note</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ä¿å­˜æˆåŠŸ&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å…³é—­æ•°æ®åº“è¿æ¥ï¼Œå¦åˆ™ç¨‹åºæ— æ³•å®Œæˆå®ƒçš„æ‰§è¡Œã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="fetching-objects-from-the-database-ä»æœåŠ¡å™¨è·å–å¯¹è±¡">Fetching objects from the database ä»æœåŠ¡å™¨è·å–å¯¹è±¡</h4>
<p>ä½¿ç”¨ <code>find()</code> æ–¹æ³•æ¥è·å–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// mongo.js
</span></span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Note</span><span class="p">.</span><span class="nx">find</span><span class="p">({}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">result</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">note</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>find({})</code> æ–¹æ³•ä¸­ <code>{}</code> æ˜¯ç©ºå¯¹è±¡ï¼Œè¡¨ç¤ºæ²¡æœ‰æ£€ç´¢æ¡ä»¶ï¼Œæ•°æ®åº“ä¼šè¿”å›æ‰€æœ‰ç»“æœã€‚</p>
<p><code>find({ important: true })</code> ä½¿ç”¨è¿™æ ·çš„æ¡ä»¶å°†ä¼šè¿”å›æ‰€æœ‰é‡è¦çš„ç¬”è®°ã€‚</p>
<h4 id="backend-connected-to-a-database-åç«¯è¿æ¥åˆ°æ•°æ®åº“">Backend connected to a database åç«¯è¿æ¥åˆ°æ•°æ®åº“</h4>
<p>ä½¿ç”¨ä¸ä¸Šæ–¹ç›¸åŒçš„æ–¹æ³•ï¼Œå°†æ•°æ®åº“è¿æ¥çš„ä»£ç æ·»åŠ åˆ° index.js ä¸­å»ï¼Œ<strong>æ³¨æ„ï¼Œè‹¥æ•°æ®åº“å¯†ç ä¸ä» <code>process</code> ä¸­å¾—åˆ°ï¼Œè€Œç›´æ¥ä¿å­˜åœ¨ <code>url</code> ä¸­ï¼Œåˆ‡å‹¿å°†å¸¦æœ‰å¯†ç çš„æ–‡ä»¶æäº¤è‡³ Github</strong>ï¼Œå¹¶å°†è·¯ç”±è°ƒæ•´å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">route</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/notes/&#39;</span><span class="p">,(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Note</span><span class="p">.</span><span class="nx">find</span><span class="p">({}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">notes</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">notes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä¸æƒ³è¦è¿”å› <code>_id</code> å’Œ <code>__v</code> å­—æ®µï¼Œé€šè¿‡ Schema çš„ toJSON æ–¹æ³•æ¥ä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š</p>
<p><strong>æ³¨æ„ä¸€ç‚¹ï¼Œmongo çš„ <code>_id</code> å­—æ®µçœ‹èµ·æ¥åƒä¸ª <code>String ç±»å‹</code>ï¼Œä½†å®ƒå…¶å®æ˜¯ä¸ªå¯¹è±¡</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">noteSchema</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;toJSON&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">transform</span><span class="o">:</span> <span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">returnedObject</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">returnedObject</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">returnedObject</span><span class="p">.</span><span class="nx">_id</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="c1">// _id å­—æ®µæ˜¯å¯¹è±¡ï¼Œéœ€è¦ toString æ–¹æ³•æ¥è½¬æ¢æˆ String
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">delete</span> <span class="nx">returnedObject</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">delete</span> <span class="nx">returnedObject</span><span class="p">.</span><span class="nx">__v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="database-configuration-into-its-own-module-æ•°æ®åº“é€»è¾‘é…ç½®åˆ°å•ç‹¬çš„æ¨¡å—">Database configuration into its own module æ•°æ®åº“é€»è¾‘é…ç½®åˆ°å•ç‹¬çš„æ¨¡å—</h4>
<p>ä¾¿äºç»´æŠ¤åŠç®¡ç†ï¼Œå°†æ•°æ®åº“é€»è¾‘é…ç½®åˆ°å•ç‹¬çš„æ¨¡å—æ˜¯è¾ƒå¥½çš„é€‰æ‹©ã€‚</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º <code>models</code> æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å»º <code>note.js</code> æ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGODB_URI</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;æ­£åœ¨è¿æ¥&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">url</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useNewUrlParser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useFindAndModify</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useCreateIndex</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;æˆåŠŸè¿æ¥ MongoDB&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;è¿æ¥ MongoDB å¤±è´¥ï¼š&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">noteSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">content</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">date</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">important</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">noteSchema</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;toJSON&#39;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">transform</span><span class="o">:</span> <span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">returnedObject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">returnedObject</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">returnedObject</span><span class="p">.</span><span class="nx">_id</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">delete</span> <span class="nx">returnedObject</span><span class="p">.</span><span class="nx">_id</span>
</span></span><span class="line"><span class="cl">    <span class="k">delete</span> <span class="nx">returnedObject</span><span class="p">.</span><span class="nx">__v</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Note&#39;</span><span class="p">,</span> <span class="nx">noteSchema</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤å¤„å®šä¹‰ <code>Note</code> modules ä¸å®šä¹‰ ES6 æ¨¡å—æ–¹å¼ç•¥æœ‰ä¸åŒã€‚</p>
<blockquote>
<p>æ¨¡å—çš„å…¬å…±æ¥å£æ˜¯é€šè¿‡å°†å€¼è®¾ç½®ä¸º module.exports å˜é‡æ¥å®šä¹‰çš„ã€‚ æˆ‘ä»¬å°†è¯¥å€¼è®¾ç½®ä¸º Note æ¨¡å‹ã€‚æ¨¡å—å†…éƒ¨å®šä¹‰çš„å…¶ä»–ä¸œè¥¿ï¼Œæ¯”å¦‚å˜é‡ mongoose å’Œ url å¯¹äºæ¨¡å—çš„ç”¨æˆ·æ¥è¯´æ˜¯ä¸å¯è®¿é—®çš„æˆ–è€…ä¸å¯è§çš„ã€‚</p>
</blockquote>
<p>åœ¨ <code>index.js</code> ä¸­å¯¼å…¥ <code>note</code> æ¨¡å—å³å¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Note</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./models/note&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°†æ•°æ®åº“çš„ <code>url</code> ç›´æ¥ç¼–å…¥ä»£ç ä¸­ä¸æ˜¯ä¸€ä¸ªå®‰å…¨çš„é€‰æ‹©ï¼Œå°†å®ƒè®¾ç½®ä¸ºç¯å¢ƒå˜é‡ <code>MONGODB_URI</code> ä¼ é€’ç»™åº”ç”¨ä¼šæ›´åˆé€‚ã€‚</p>
<p>å®šä¹‰ç¯å¢ƒå˜é‡çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼š</p>
<ul>
<li>åœ¨å¯åŠ¨æ—¶å®šä¹‰ã€‚ <em>åœ¨ <code>package.json</code> ä¸­æ·»åŠ  <code>scripts</code></em></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;mongodb&#34;</span><span class="err">:</span> <span class="s2">&#34;MONGODB_URI=address_here npm run dev&#34;</span><span class="err">,</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ›´å¤æ‚çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <code>dotenv</code> åº“</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm install dotenv
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º <code>.env</code> æ–‡ä»¶ï¼Œç¯å¢ƒå˜é‡åœ¨æ”¹æ–‡ä»¶å†…å®šä¹‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MONGODB_URI=&#39;mongodb+srv://fullstack:passwordhere@icluster.fmdqa.mongodb.net/note-app?retryWrites=true&amp;w=majority&#39;
</span></span><span class="line"><span class="cl">PORT=3001
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ <code>.gitignore</code> ä¸­æ·»åŠ  <code>.env</code> æ¡ç›®æ¥é¿å…å°†ç¯å¢ƒå˜é‡ä¸Šä¼ è‡³ githubï¼Œå¹¶åœ¨ <code>index.js</code> ç¬¬ä¸€è¡Œæ·»åŠ  <code>require('dotenv'.config)</code> å‘½ä»¤æ¥ä½¿ç”¨ <code>.env</code> ä¸­çš„ç¯å¢ƒå˜é‡ã€‚å¼•ç”¨ç¯å¢ƒå˜é‡çš„æ–¹æ³•ä¸æ™®é€šç¯å¢ƒå˜é‡ä¸€æ · <code>process.env.MONGODB_URI</code>ã€‚</p>
<h4 id="using-database-in-route-handlers-åœ¨è·¯ç”±å¤„ç†ç¨‹åºä¸­ä½¿ç”¨æ•°æ®åº“">Using database in route handlers åœ¨è·¯ç”±å¤„ç†ç¨‹åºä¸­ä½¿ç”¨æ•°æ®åº“</h4>
<p>æ·»åŠ ä¸€æ¡æ–°ç¬”è®°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/notes&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;æäº¤çš„å†…å®¹ç¼ºå¤±&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ä½¿ç”¨ Note æ„é€ å‡½æ•°åˆ›å»º Note å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">note</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Note</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">content</span><span class="o">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">important</span><span class="o">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">important</span> <span class="o">||</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">date</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">note</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">saveNote</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ“ä½œæˆåŠŸæ—¶æ‰å‘é€ response
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">saveNote</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ mongoose çš„ <code>findById</code> æ–¹æ³•è·å–å•ç‹¬ä¸€æ¡ç¬”è®°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/notes/:id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">note</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">note</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="verifying-frontend-and-backend-integration-éªŒè¯å‰ç«¯å’Œåç«¯çš„é›†æˆ">Verifying frontend and backend integration éªŒè¯å‰ç«¯å’Œåç«¯çš„é›†æˆ</h4>
<p>ä½¿ç”¨ POSTMAN æˆ–è€…å…¶ä»–å·¥å…·æ¥æµ‹è¯•åç«¯ã€‚</p>
<h4 id="error-handling-é”™è¯¯å¤„ç†">Error handling é”™è¯¯å¤„ç†</h4>
<p>é€šè¿‡ <code>.catch</code> æ–¹æ³•æ¥æ•è·é”™è¯¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/notes/:id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Note</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">note</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">end</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">end</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“è¯·æ±‚æŒ‡å®š id çš„ç¬”è®°ä¸å­˜åœ¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 404 é”™è¯¯ï¼Œå½“ç»™å‡ºçš„ id æ˜¯ä¸€ä¸ªå¥‡æ€ªçš„å‚æ•°æ—¶ï¼Œ <code>findById</code> æ–¹æ³•ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå¯¼è‡´ <code>Promise</code> è¿”å› <code>rejected</code>ï¼Œå› æ­¤ä¼šè§¦å‘ <code>catch</code> ä»£ç ä¸­çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ <em>500 internal server error</em>ã€‚</p>
<p>å®é™…ä¸Šå½“ id æ ¼å¼ä¸æ­£ç¡®ä¼šè§¦å‘ <code>catch</code> çš„ä»£ç ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªé”™è¯¯å®šä¹‰ä¸º <code>400 bad request</code> æ¯”è¾ƒç¬¦åˆå¯¹é”™è¯¯çš„æè¿°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;è¯·æ±‚é”™è¯¯ï¼Œid æ ¼å¼ä¸æ­£ç¡®&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è°ƒç”¨é”™è¯¯å¤„ç†ç¨‹åºçš„åŸå› å¯èƒ½ä¸æ‚¨é¢„æœŸçš„å®Œå…¨ä¸åŒã€‚ å¦‚æœæ‚¨å°†é”™è¯¯è®°å½•åˆ°æ§åˆ¶å°ï¼Œæ‚¨å¯ä»¥é¿å…å†—é•¿å’Œä»¤äººæ²®ä¸§çš„è°ƒè¯•ä¼šè¯ã€‚</p>
</blockquote>
<h4 id="moving-error-handling-into-middleware-å°†é”™è¯¯å¤„ç†ç§»å…¥ä¸­é—´ä»¶">Moving error handling into middleware å°†é”™è¯¯å¤„ç†ç§»å…¥ä¸­é—´ä»¶</h4>
<p>ä¸Šè¿°ä»£ç æ˜¯åœ¨å•ä¸ªè·¯ç”±å†…ç¼–å†™äº†é”™è¯¯å¤„ç†ç¨‹åºï¼Œè¿™æ˜¯ä¸€ç§æ–¹æ³•ã€‚åœ¨å•ä¸ªä½ç½®å®ç°æ‰€æœ‰çš„é”™è¯¯å¤„ç†ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹æ³•ã€‚</p>
<blockquote>
<p>å¦‚æœæˆ‘ä»¬ä»¥åæƒ³è¦å°†ä¸é”™è¯¯ç›¸å…³çš„æ•°æ®æŠ¥å‘Šç»™å¤–éƒ¨çš„é”™è¯¯è·Ÿè¸ªç³»ç»Ÿï¼Œæ¯”å¦‚ <a href="https://sentry.io/welcome/" target="_blank" rel="noopener noreffer">Sentry</a>ï¼Œé‚£ä¹ˆè¿™ä¹ˆåšå°±ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
</blockquote>
<p>åœ¨è·¯ç”±ä¸­ï¼Œä½¿ç”¨ <code>next</code> å‡½æ•°å‘ä¸‹ä¼ é€’é”™è¯¯ï¼Œ<code>next</code> å‡½æ•°ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™å¤„ç†ç¨‹åºã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/notes/:id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Note</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">note</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">end</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å°†å‘å‰ä¼ é€’çš„é”™è¯¯ä½œä¸ºå‚æ•°ç»™ <code>next</code> å‡½æ•°ã€‚ å¦‚æœåœ¨æ²¡æœ‰å‚æ•°çš„æƒ…å†µä¸‹è°ƒç”¨ <code>next</code>ï¼Œé‚£ä¹ˆæ‰§è¡Œå°†ç®€å•åœ°è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±æˆ–ä¸­é—´ä»¶ä¸Šã€‚ å¦‚æœä½¿ç”¨å‚æ•°è°ƒç”¨  <code>next</code> å‡½æ•°ï¼Œé‚£ä¹ˆæ‰§è¡Œå°†ç»§ç»­åˆ° error å¤„ç†ç¨‹åºä¸­é—´ä»¶ã€‚</p>
</blockquote>
<p>Express çš„ <code>errorHandler</code> æ˜¯ä¸€ç§ä¸­é—´ä»¶ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæ¥å— 4 ä¸ªå‚æ•°çš„å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">errorHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;CastError&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">error</span><span class="p">.</span><span class="nx">kind</span> <span class="o">===</span> <span class="s1">&#39;ObjectId&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;è¯·æ±‚é”™è¯¯ï¼Œid æ ¼å¼ä¸æ­£ç¡®&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">errorHandler</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>errorHandler</code> å°†ä¼šæ£€æŸ¥é”™è¯¯æ˜¯å¦æ˜¯ <em>CastError</em> é”™è¯¯ä»¥åŠç§ç±»æ˜¯å¦æ˜¯ <em>ObjectId</em>ï¼Œå¦‚æœæ˜¯å°†ä¼šè¿”å› 400 é”™è¯¯ä»¥åŠé”™è¯¯æ¶ˆæ¯ã€‚å¦‚æœä¸æ˜¯ï¼Œä¸­é—´ä»¶å°†ä¼šè½¬å‘é”™è¯¯è‡³ç¼ºçœçš„ Express é”™è¯¯å¤„ç†ç¨‹åºã€‚</p>
<h4 id="the-order-of-middleware-loading-ä¸­é—´ä»¶åŠ è½½çš„é¡ºåº">The order of middleware loading ä¸­é—´ä»¶åŠ è½½çš„é¡ºåº</h4>
<p>ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºä¸é€šè¿‡ <code>app.use</code> å‡½æ•°åŠ è½½åˆ° Express é¡ºåºç›¸åŒ*ã€Œè‡ªä¸Šè€Œä¸‹ã€*ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">logger</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;api/notes&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">unknownEndpoint</span> <span class="o">=</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è®¿é—®ä¸å­˜åœ¨é¡µé¢çš„å¤„ç†ç¨‹åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">unknownEndpoint</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">errorHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">errorHandler</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœ <code>app.use(express.json())</code> æ”¾åœ¨äº† <code>app.post</code> è·¯ç”±ä¸‹é¢ï¼Œé‚£ä¹ˆ <code>express.json()</code> å°†ä¼šåœ¨è·¯ç”±ä¹‹åæ‰§è¡Œï¼Œè¿™æ„å‘³ç€ <code>app.post</code> ä¸­çš„ <code>body</code> æ— æ³•æ­£ç¡®åœ°è·å¾—æ•°æ®ï¼Œå› ä¸º <code>req.body</code> æ˜¯ undefinedã€‚</p>
<h4 id="other-operations-å…¶ä»–æ“ä½œ">Other operations å…¶ä»–æ“ä½œ</h4>
<p><code>findByIdAndRemove</code> æ–¹æ³•åŠ <code>findByIdAndUpdate</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/api/notes/:id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">note</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">content</span><span class="o">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">important</span><span class="o">:</span> <span class="nx">body</span><span class="p">.</span><span class="nx">important</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">Note</span><span class="p">.</span><span class="nx">findByIdAndUpdate</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">note</span><span class="p">,</span> <span class="p">{</span> <span class="k">new</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">updatedNote</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">updatedNote</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="nx">next</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ <code>findByIdAndUpdate</code> æ–¹æ³•ä¸­ä½¿ç”¨äº†å¯é€‰å‚æ•° <code>{ new: true }</code>ï¼Œè¿™æ · <code>updateedNote</code> æ¥æ”¶åˆ°çš„æ˜¯ä¿®æ”¹åçš„æ–‡æ¡£ã€‚é»˜è®¤æƒ…å†µä¸‹ <code>updatedNote</code> æ¥æ”¶åˆ°çš„æ˜¯åŸå§‹æœªä¿®æ”¹çš„æ–‡æ¡£ã€‚è¿™ç‚¹è¦æ³¨æ„ã€‚</p>
<h3 id="eslint-ä¸ä»£ç æ£€æŸ¥">ESLint ä¸ä»£ç æ£€æŸ¥</h3>
<p>å…ˆå‰åœ¨è·¯ç”±ä¸­æ£€æŸ¥ç¬”è®°çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå°†è¿”å› 400 é”™è¯¯ä¿¡æ¯ä»¥åŠé”™è¯¯ä¿¡æ¯ã€Œæäº¤çš„å†…å®¹ç¼ºå¤±ã€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/notes&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;æäº¤çš„å†…å®¹ç¼ºå¤±&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ä¹‹å‰éªŒè¯æ•°æ®çš„ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨ mongoose æä¾›çš„ <a href="https://mongoosejs.com/docs/validation.html" target="_blank" rel="noopener noreffer">validation</a> åŠŸèƒ½ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">noteSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">content</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>   <span class="c1">// å­—ç¬¦ä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">minLength</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>   <span class="c1">// æœ€å°é•¿åº¦ 5 å­—ç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span>  <span class="c1">// å¿…å¡«
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">date</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span>     <span class="c1">// æ—¥æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span>  <span class="c1">// å¿…å¡«
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">important</span><span class="o">:</span> <span class="nb">Boolean</span>  <span class="c1">// å¸ƒå°”å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>minlength å’Œ required éªŒè¯å™¨æ˜¯å†…ç½®çš„ ï¼Œç”± Mongoose æä¾›ã€‚å¦‚æœæ²¡æœ‰ä¸€ä¸ªå†…ç½®çš„éªŒè¯å™¨æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚çš„è¯ï¼ŒMongoose å…è®¸æˆ‘ä»¬åˆ›å»ºæ–°çš„éªŒè¯å™¨è‡ªå®šä¹‰éªŒè¯å™¨ã€‚</p>
</blockquote>
<p>åœ¨ <code>errorHandler</code> ä¸­é—´ä»¶å¢åŠ  <code>validation</code> çš„åˆ¤æ–­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">errorHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;CastError&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span><span class="p">.</span><span class="nx">kind</span> <span class="o">===</span> <span class="s1">&#39;ObjectId&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;error id&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;ValidationError&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="promise-chaining-æ‰¿è¯ºé“¾">Promise chaining æ‰¿è¯ºé“¾</h4>
<p>æ•™ææ‰€è®²çš„æ˜¯æ‰¿è¯ºé“¾çš„æ¦‚å¿µï¼Œæ‰€ç”¨çš„æ¡ˆä¾‹å¹¶ä¸æ˜¯å¾ˆå…¸å‹ï¼Œå¼•ç”¨ä½œè€…çš„è¯ï¼š</p>
<blockquote>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰¿è¯ºé“¾æ²¡æœ‰æä¾›å¤šå°‘å¥½å¤„ã€‚ ä½†è¦æ˜¯æœ‰è®¸å¤šå¿…é¡»æŒ‰é¡ºåºè¿›è¡Œçš„å¼‚æ­¥æ“ä½œï¼Œæƒ…å†µå°±ä¼šå‘ç”Ÿå˜åŒ–â€¦â€¦åœ¨æœ¬è¯¾ç¨‹çš„ä¸‹ä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹  JavaScript ä¸­çš„async/await è¯­æ³•ï¼Œè¿™å°†ä½¿ç¼–å†™åç»­çš„å¼‚æ­¥æ“ä½œå˜å¾—å®¹æ˜“å¾—å¤šã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">note</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">then</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">then</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">then</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="k">catch</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>.then</code> è¿”å›äº†ä¸€ä¸ª <code>Promise</code>ï¼Œé€šè¿‡å¤šä¸ª <code>.then</code> æ–¹æ³•ç»„æˆäº† <code>Promise Chaining</code>ã€‚</p>
<p>å¦‚åŒ then çš„å­—é¢æ„æ€ï¼Œä»£ç æ˜¯ä¾æ¬¡æ‰§è¡Œçš„ã€‚</p>
<h4 id="deploying-the-database-backend-to-production-å°†æ•°æ®åº“åç«¯éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ">Deploying the database backend to production å°†æ•°æ®åº“åç«¯éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ</h4>
<p>ç•¥</p>
<h4 id="lint">Lint</h4>
<p>Lint æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>Generically, lint or a linter is any tool that detects and flags errors in programming languages, including stylistic errors. The term lint-like behavior is sometimes applied to the process of flagging suspicious language usage. Lint-like tools generally perform static analysis of source code.</p>
<p>é€šå¸¸ï¼Œlint æˆ– linter æ˜¯æ£€æµ‹å’Œæ ‡è®°ç¼–ç¨‹è¯­è¨€ä¸­çš„é”™è¯¯ï¼ŒåŒ…æ‹¬æ–‡æœ¬é”™è¯¯çš„ä¸€ç§å·¥å…·ã€‚ lint-like è¿™ä¸ªæœ¯è¯­æœ‰æ—¶ç”¨äºæ ‡è®°å¯ç–‘çš„è¯­è¨€ä½¿ç”¨æƒ…å†µã€‚ ç±»ä¼¼ lint çš„å·¥å…·é€šå¸¸å¯¹æºä»£ç æ‰§è¡Œé™æ€åˆ†æã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨åƒ Java è¿™æ ·çš„ç¼–è¯‘é™æ€ç±»å‹è¯­è¨€ä¸­ï¼Œåƒ NetBeans è¿™æ ·çš„ IDE å¯ä»¥æŒ‡å‡ºä»£ç ä¸­çš„é”™è¯¯ï¼Œç”šè‡³é‚£äº›ä¸ä»…ä»…æ˜¯ç¼–è¯‘é”™è¯¯çš„é”™è¯¯ã€‚ æ‰§è¡Œé™æ€åˆ†æçš„é¢å¤–å·¥å…·ï¼Œå¦‚æ£€æŸ¥æ ·å¼ ï¼Œå¯ä»¥ç”¨æ¥æ‰©å±• IDE çš„åŠŸèƒ½ï¼Œä¹ŸæŒ‡å‡ºä¸æ ·å¼æœ‰å…³çš„é—®é¢˜ï¼Œå¦‚ç¼©è¿›ã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨ JavaScript çš„ä¸–ç•Œé‡Œï¼Œç›®å‰ä¸»è¦çš„é™æ€åˆ†æå·¥å…·åˆå ã€Œlintingã€æ˜¯ <a href="https://eslint.org/" target="_blank" rel="noopener noreffer">ESlint</a>ã€‚</p>
</blockquote>
<p>å®‰è£… ESlint ä½œä¸ºå¼€å‘ä¾èµ–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm install eslint --save-dev
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆå§‹åŒ–é»˜è®¤è®¾ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">node_modules/.bin/eslint --init
</span></span></code></pre></td></tr></table>
</div>
</div><figure><img src="https://fullstackopen.com/static/ba1423527692484103dcb2b7374eeb01/5a190/52be.png"/>
</figure>

<p>è¯¥é…ç½®å°†ä¿å­˜åœ¨ <code>.eslintrc.js</code> æ–‡ä»¶ä¸­ã€‚</p>
<p>å¯æ ¹æ®ä¹ æƒ¯ä¿®æ”¹è§„åˆ™ï¼Œæ¯”å¦‚ä½¿ç”¨ 2 ä¸ª spaceã€‚</p>
<p>æ£€æŸ¥éªŒè¯æ–¹å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">node_modules/.bin/eslint index.js
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸º linting åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;start&#34;</span><span class="p">:</span> <span class="s2">&#34;node index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="s2">&#34;nodemon index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nt">&#34;lint&#34;</span><span class="p">:</span> <span class="s2">&#34;eslint .&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨æ ¹ç›®å½•æ–°å»º <code>.eslintignore</code> å¹¶å¢åŠ æƒ³è¦å¿½ç•¥æ£€æŸ¥çš„æ–‡ä»¶ã€‚</p>
<p>å®‰è£… <code>eslint-plugin</code> æ¥æ›¿ä»£ä½¿ç”¨å‘½ä»¤æ£€æŸ¥ä»£ç ä¸­çš„é”™è¯¯ï¼ŒESlint æ’ä»¶ä¼šå°†ä¸ç¬¦åˆè§„åˆ™çš„ä»£ç ä½¿ç”¨çº¢è‰²æ³¢æµªçº¿æ ‡è®°å‡ºæ¥ã€‚</p>
<p>ESlint æœ‰å¤§é‡çš„<a href="https://eslint.org/docs/rules/" target="_blank" rel="noopener noreffer">è§„åˆ™</a>ï¼Œ é€šè¿‡åœ¨ <code>.eslintrc.js</code> æ–‡ä»¶ä¸­ç¼–è¾‘å¢åŠ è§„åˆ™å³å¯ã€‚</p>
<blockquote>
<p>è®¸å¤šå…¬å¸å®šä¹‰äº†é€šè¿‡ ESlint é…ç½®æ–‡ä»¶åœ¨æ•´ä¸ªç»„ç»‡ä¸­æ‰§è¡Œçš„ç¼–ç æ ‡å‡†ã€‚ å»ºè®®ä¸è¦ä¸€éåˆä¸€éåœ°ä½¿ç”¨é‡é€ è½®å­ï¼Œä»åˆ«äººçš„é¡¹ç›®ä¸­é‡‡ç”¨ç°æˆçš„é…ç½®åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­å¯èƒ½æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ æœ€è¿‘ï¼Œå¾ˆå¤šé¡¹ç›®éƒ½é‡‡ç”¨äº† Airbnb çš„ Javascript é£æ ¼æŒ‡å—ï¼Œä½¿ç”¨äº† Airbnb çš„ <a href="https://github.com/airbnb/javascript/tree/master/packages/eslint-config-airbnb" target="_blank" rel="noopener noreffer">ESlint</a> ã€‚</p>
</blockquote></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2020-12-09</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://x.awo.design/2020/12/fullstackopen-nodejs-express/" data-title="å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 03 - ç”¨ NodeJS å’Œ Express å†™æœåŠ¡ç«¯ç¨‹åº" data-hashtags="React,JavaScript"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://x.awo.design/2020/12/fullstackopen-nodejs-express/" data-hashtag="React"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° WhatsApp" data-sharer="whatsapp" data-url="https://x.awo.design/2020/12/fullstackopen-nodejs-express/" data-title="å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 03 - ç”¨ NodeJS å’Œ Express å†™æœåŠ¡ç«¯ç¨‹åº" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://x.awo.design/2020/12/fullstackopen-nodejs-express/" data-title="å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 03 - ç”¨ NodeJS å’Œ Express å†™æœåŠ¡ç«¯ç¨‹åº"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://x.awo.design/2020/12/fullstackopen-nodejs-express/" data-title="å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 03 - ç”¨ NodeJS å’Œ Express å†™æœåŠ¡ç«¯ç¨‹åº"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Evernote" data-sharer="evernote" data-url="https://x.awo.design/2020/12/fullstackopen-nodejs-express/" data-title="å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 03 - ç”¨ NodeJS å’Œ Express å†™æœåŠ¡ç«¯ç¨‹åº"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/react/">React</a>,&nbsp;<a href="/tags/javascript/">JavaScript</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2020/11/fullstackopen-server/" class="prev" rel="prev" title="å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 02 - ä¸æœåŠ¡å™¨é€šä¿¡"><i class="fas fa-angle-left fa-fw"></i>å…¨æ ˆå…¬å¼€è¯¾2020å­¦ä¹ ç¬”è®° 02 - ä¸æœåŠ¡å™¨é€šä¿¡</a>
            <a href="/2021/01/annual-report-2020/" class="next" rel="next" title="2020å¹´å¹´åº¦æ€»ç»“">2020å¹´å¹´åº¦æ€»ç»“<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.104.3">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2017 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://awo.design" target="_blank">imagicw</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.4710034e669c7ff17f823f9ba12cf8a36582d65b007f79cbc4a3c11d7db2e4ca.css" integrity="sha256-RxADTmacf/F/gj&#43;boSz4o2WC1lsAf3nLxKPBHX2y5Mo="><link rel="stylesheet" href="/lib/katex/copy-tex.min.bf9ff4137fec38f6255419e142d0883c9c52090885d746f80eee12b273d9b3e0.css" integrity="sha256-v5/0E3/sOPYlVBnhQtCIPJxSCQiF10b4Du4SsnPZs&#43;A="><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.cd0d0b6e50ff01ff2f3a9a70d7cfb66a7c6cb9acf7a566325568be6d3bd31fc4.css" integrity="sha256-zQ0LblD/Af8vOppw18&#43;2anxsuaz3pWYyVWi&#43;bTvTH8Q="><script type="text/javascript" src="https://imagicw.disqus.com/embed.js" defer></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.bcff85fb5e00d68802850b393ac7792c997f722f536f38e26638c46dca8e5eb6.js" integrity="sha256-vP&#43;F&#43;14A1ogChQs5Osd5LJl/ci9TbzjiZjjEbcqOXrY="></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.615590a2ca2b667afa7c02ef396f5500b62e22795ddbb46448f90494605d09a5.js" integrity="sha256-YVWQosorZnr6fALvOW9VALYuInld27RkSPkElGBdCaU="></script><script type="text/javascript" src="/lib/lunr/lunr.min.df84a2d58ea594c04a3371b48d020b55ea10284c2ec636e4e331965d7313e29b.js" integrity="sha256-34Si1Y6llMBKM3G0jQILVeoQKEwuxjbk4zGWXXMT4ps="></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.8127f0ca4cabc7246f3620f3ef3bf9b1db02805dfe03d6d4c57bc74bc0bf6eea.js" integrity="sha256-gSfwykyrxyRvNiDz7zv5sdsCgF3&#43;A9bUxXvHS8C/buo="></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.df40c83b86d7cea2122cd35d56db3e6e4bc34b09a62755f0f3c48b5e9c66a8a4.js" integrity="sha256-30DIO4bXzqISLNNdVts&#43;bkvDSwmmJ1Xw88SLXpxmqKQ="></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.fb649fcae62177dfe63e67081ddceb830b5ce1f05a4184e9bbb7d87ac4b8f4e5.js" integrity="sha256-&#43;2SfyuYhd9/mPmcIHdzrgwtc4fBaQYTpu7fYesS49OU="></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.8a7739925f4c03586479852df840b7061948832a7fda30c8c812d2ea4dd4c4f2.js" integrity="sha256-inc5kl9MA1hkeYUt&#43;EC3BhlIgyp/2jDIyBLS6k3UxPI="></script><script type="text/javascript" src="/lib/sharer/sharer.min.9c88f86c7f0820287113f6236200459832693656e80d7556cc80a93dfbd45813.js" integrity="sha256-nIj4bH8IIChxE/YjYgBFmDJpNlboDXVWzICpPfvUWBM="></script><script type="text/javascript" src="/lib/katex/katex.min.17f5dd6b9f123dd7140abfb18521b3f4c036cd004f6f40121182a8865f140877.js" integrity="sha256-F/Xda58SPdcUCr&#43;xhSGz9MA2zQBPb0ASEYKohl8UCHc="></script><script type="text/javascript" src="/lib/katex/auto-render.min.f74776a677f0d2be0af0264058f928e2ba455d0b19bc985304660d922a43a6b2.js" integrity="sha256-90d2pnfw0r4K8CZAWPko4rpFXQsZvJhTBGYNkipDprI="></script><script type="text/javascript" src="/lib/katex/copy-tex.min.2ab2237329021bc443986c8327f6e61357fb68a54e5d233d224023718c02207d.js" integrity="sha256-KrIjcykCG8RDmGyDJ/bmE1f7aKVOXSM9IkAjcYwCIH0="></script><script type="text/javascript" src="/lib/katex/mhchem.min.5cea356d6025c5a2f18c454c83ec5674dbb04fab1cd1d75569e77788c6b6f888.js" integrity="sha256-XOo1bWAlxaLxjEVMg&#43;xWdNuwT6sc0ddVaed3iMa2&#43;Ig="></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.e55842a856a6d829feca3c3ad736c136b6c7549e9247274f78aa296259e06e24.js" integrity="sha256-5VhCqFam2Cn&#43;yjw61zbBNrbHVJ6SRydPeKopYlngbiQ="></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":12},"comment":{},"cookieconsent":{"content":{"dismiss":"åŒæ„","link":"äº†è§£æ›´å¤š","message":"æœ¬ç½‘ç«™ä½¿ç”¨ Cookies æ¥æ”¹å–„æ‚¨çš„æµè§ˆä½“éªŒ."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.f51938f3065a40ee841bcb558e4330e31fd26c0ea55343fff8770b88b0319a3c.js" integrity="sha256-9Rk48wZaQO6EG8tVjkMw4x/SbA6lU0P/&#43;HcLiLAxmjw="></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'UA-92164716-1', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-92164716-1" async></script></body>
</html>
